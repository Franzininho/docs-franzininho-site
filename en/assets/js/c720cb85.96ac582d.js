"use strict";(self.webpackChunkFranzininho=self.webpackChunkFranzininho||[]).push([[3916],{77584:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>t,contentTitle:()=>a,default:()=>m,frontMatter:()=>s,metadata:()=>d,toc:()=>l});var i=r(17624),n=r(4552);const s={id:"timer0",title:"Timer 0",slug:"/franzininho-diy/exemplos-avr-libc/timer0",description:"Vamos aprender usar o timer 0 como temporizador",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},a=void 0,d={id:"FranzininhoDIY/exemplos-avr-libc/timer0",title:"Timer 0",description:"Vamos aprender usar o timer 0 como temporizador",source:"@site/docs/FranzininhoDIY/exemplos-avr-libc/timer0.md",sourceDirName:"FranzininhoDIY/exemplos-avr-libc",slug:"/franzininho-diy/exemplos-avr-libc/timer0",permalink:"/en/docs/franzininho-diy/exemplos-avr-libc/timer0",draft:!1,unlisted:!1,editUrl:"https://github.com/Franzininho/docs-franzininho-site/edit/main/docs/FranzininhoDIY/exemplos-avr-libc/timer0.md",tags:[],version:"current",frontMatter:{id:"timer0",title:"Timer 0",slug:"/franzininho-diy/exemplos-avr-libc/timer0",description:"Vamos aprender usar o timer 0 como temporizador",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},sidebar:"docs",previous:{title:"Entrada Digital",permalink:"/en/docs/franzininho-diy/exemplos-avr-libc/entrada-digital"},next:{title:"Timer 0 - Interrup\xe7\xe3o",permalink:"/en/docs/franzininho-diy/exemplos-avr-libc/timer0-int"}},t={},l=[{value:"Caracter\xedsticas do Timer0",id:"caracter\xedsticas-do-timer0",level:2},{value:"Resumo de recursos do Timer0",id:"resumo-de-recursos-do-timer0",level:2},{value:"Usando o Timer0 como temporizador",id:"usando-o-timer0-como-temporizador",level:2},{value:"Passo para configurar o Timer0 como temporizador",id:"passo-para-configurar-o-timer0-como-temporizador",level:3},{value:"Calculo do Delay",id:"calculo-do-delay",level:3},{value:"Passos para monitorar o overflow do timer e gerar o delay de 1s",id:"passos-para-monitorar-o-overflow-do-timer-e-gerar-o-delay-de-1s",level:3},{value:"Recursos necess\xe1rios",id:"recursos-necess\xe1rios",level:3},{value:"C\xf3digo exemplo",id:"c\xf3digo-exemplo",level:3},{value:"Simula\xe7\xe3o do exemplo",id:"simula\xe7\xe3o-do-exemplo",level:3}];function c(e){const o={a:"a",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.p,{children:"Os timers s\xe3o perif\xe9ricos muito importantes nos microcontroladores. Podemos us\xe1-los para temporiza\xe7\xe3o, contagem de eventos, PWM, medir pulsos externos, etc. O ATtiny85 possui 2 timers, chamados de Timer0 e Timer1. Nesse exemplos vamos focar no uso do Timer0 como temporizador."}),"\n",(0,i.jsx)(o.h2,{id:"caracter\xedsticas-do-timer0",children:"Caracter\xedsticas do Timer0"}),"\n",(0,i.jsx)(o.p,{children:"O Timer0 \xe9 um m\xf3dulo temporizador/contador de 8 bits de uso geral. Isso significa que ele pode contar de 0 a 255. A funcionalidade de temporiza\xe7\xe3o pode ser estendida ainda mais usando os perif\xe9ricos de compara\xe7\xe3o, que permitem que o temporizador conte eventos, gere sinais PWM e assim por diante. Assim \xe9 poss\xedvel gerar temporiza\xe7\xf5es precisas, ondas e sinais PWM independentes da CPU."}),"\n",(0,i.jsx)(o.p,{children:"A figura a seguir exibe o diagrama de blocos simplificado do Timer0:"}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{alt:"Diagrama de blocos do Timer0",src:r(17712).c+"",width:"862",height:"668"})}),"\n",(0,i.jsx)(o.h2,{id:"resumo-de-recursos-do-timer0",children:"Resumo de recursos do Timer0"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Duas unidades de compara\xe7\xe3o de sa\xedda independentes;"}),"\n",(0,i.jsx)(o.li,{children:"Registradores de compara\xe7\xe3o de sa\xedda com buffer duplo;"}),"\n",(0,i.jsx)(o.li,{children:"Limpa cron\xf4metro na compara\xe7\xe3o de correspond\xeancia (recarregamento autom\xe1tico);"}),"\n",(0,i.jsx)(o.li,{children:"Modulador de largura de pulso com corre\xe7\xe3o de fase (PWM) livre de glitch;"}),"\n",(0,i.jsx)(o.li,{children:"Per\xedodo PWM vari\xe1vel;"}),"\n",(0,i.jsx)(o.li,{children:"Gerador de frequ\xeancia;"}),"\n",(0,i.jsx)(o.li,{children:"Tr\xeas fontes de interrup\xe7\xe3o independentes (TOV0, OCF0A e OCF0B);"}),"\n"]}),"\n",(0,i.jsx)(o.h2,{id:"usando-o-timer0-como-temporizador",children:"Usando o Timer0 como temporizador"}),"\n",(0,i.jsx)(o.p,{children:"Nesse exemplos vamos usar o Timer0 para gerar delay de 1s para piscar um LED."}),"\n",(0,i.jsx)(o.h3,{id:"passo-para-configurar-o-timer0-como-temporizador",children:"Passo para configurar o Timer0 como temporizador"}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.strong,{children:"Passo 1:"})," Configurar o Timer0 para trabalhar no modo normal. Nesse modo o timer iniciar\xe1 a contagem em 0 e ir\xe1 at\xe9 m\xe1ximo de 255. Quando atingido o m\xe1ximo \xe9 gerado um flag de sinaliza\xe7\xe3o de overflow e o timer volta a contar a partir do zero."]}),"\n",(0,i.jsxs)(o.p,{children:["Para configurar o modo de opera\xe7\xe3o normal, devemos configurar o registrador ",(0,i.jsx)(o.strong,{children:"TCCR0A \u2013 Timer/Counter Control Register A"})," da seguinte forma:"]}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"COM0A[1:0] e COM0B[1:0] = 0"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:r(37276).c+"",width:"840",height:"212"})}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"WGM0[1:0] = 0 e TCCR0B \u2013 WGM02 = 0"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:r(84640).c+"",width:"841",height:"333"})}),"\n",(0,i.jsxs)(o.p,{children:["Deve-se escrever os seguintes valores em ",(0,i.jsx)(o.strong,{children:"TCCR0A \u2013 Timer/Counter Control Register A"}),":"]}),"\n",(0,i.jsx)(o.p,{children:"TCCR0A = 0b00000000;"}),"\n",(0,i.jsxs)(o.p,{children:[(0,i.jsx)(o.strong,{children:"Passo 2:"})," Ajustar o prescaler do clock interno para 1024"]}),"\n",(0,i.jsx)(o.p,{children:"Para ajustar o prescale precisamos configurar os bits CS02,CS01 e CS00 do TCCR0B:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"TCCR0B \u2013 CS0[2:0]"}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:(0,i.jsx)(o.img,{src:r(9264).c+"",width:"839",height:"315"})}),"\n",(0,i.jsxs)(o.p,{children:["Deve-se escrever os seguintes valores em ",(0,i.jsx)(o.strong,{children:"TCCR0B \u2013 Timer/Counter Control Register"})," B:"]}),"\n",(0,i.jsx)(o.p,{children:"TCCR0B = 0b00000101;"}),"\n",(0,i.jsx)(o.h3,{id:"calculo-do-delay",children:"Calculo do Delay"}),"\n",(0,i.jsx)(o.p,{children:"Estamos trabalhando com o clock interno do ATtiny85 em 16.5Mhz. Essa \xe9 a fonte de clock para o timer0 em modo de opera\xe7\xe3o normal. Como selecionamos o prescaler para dividir o clock por 1024, temos o incremento do timer0 em:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["tempo por incremento do timer0 = 1/(16.5M/1024) = ",(0,i.jsx)(o.strong,{children:"62 us"})]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Assim, o tempo para o timer0 estourar(overflow) \xe9:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["tempo para o timer0 estourar = 62us x 256 = ",(0,i.jsx)(o.strong,{children:"15,89ms"})]}),"\n"]}),"\n",(0,i.jsx)(o.p,{children:"Portanto, para ter um delay de 1 segundo precisamos ter:"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:["quantidade de overflows do timer0 = 1/15,89ms \u2243 ",(0,i.jsx)(o.strong,{children:"63 vezes"})]}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"passos-para-monitorar-o-overflow-do-timer-e-gerar-o-delay-de-1s",children:"Passos para monitorar o overflow do timer e gerar o delay de 1s"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Passo 0:"})," Colocar TCNT0 em zero"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Passo 1:"})," Aguardar a contagem do timer verificando quando TOV0 vai para 1"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Passo 2:"})," Limpar a flag TOV0 escrevendo 1 nela(Isso mesmo escrevendo 1)"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Passo 3:"})," Repetir passos 1 e 2 63 vezes para atingir 1 segundo"]}),"\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"Passo 4:"})," Passou um segundo \u2013 Inverter LED"]}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"recursos-necess\xe1rios",children:"Recursos necess\xe1rios"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"Placa Franzininho DIY(com Micronucleus)"}),"\n",(0,i.jsx)(o.li,{children:"LED"}),"\n",(0,i.jsx)(o.li,{children:"Resistor de 470 Ohm"}),"\n",(0,i.jsx)(o.li,{children:"Jumpers"}),"\n",(0,i.jsx)(o.li,{children:"Computador com as ferramentas de software instaladas"}),"\n"]}),"\n",(0,i.jsx)(o.h3,{id:"c\xf3digo-exemplo",children:"C\xf3digo exemplo"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-c",children:'/**\n * \n * @file main.c\n * @author F\xe1bio Souza\n * @brief Exibe como usar o timer zero para temporiza\xe7\xe3o\n * @version 0.1\n * @date 2021-02-13\n * \n * @copyright Franzininho \n * This example code is in the Public Domain (or CC0 licensed, at your option.)\n * Unless required by applicable law or agreed to in writing, this\n * software is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied.\n * \n */\n\n#include <avr/io.h>\n#include <util/delay.h> \n\n#define F_CPU 16500000L\n\n \t\n#define setBit(valor,bit) (valor |= (1<<bit))\n#define clearBit(valor,bit) (valor &= ~(1<<bit))\n#define toogleBit(valor,bit) (valor ^= (1<<bit))\n#define testBit(valor,bit)    (valor & (1<<bit))\n\n/**\n * @brief Fun\xe7\xe3o main\n * \n * @return int \n */\nint main(void) \n{\n  \n  unsigned char tempo = 0;  //contador auxiliar\n\n  setBit(DDRB,PB1); \t// Configura Pino PB1 como sa\xedda (Pino do LED)\n\n  //configura\xe7\xe3o do timer0 para overflow a aproximadamente 15,89 ms\n  //t = (1/16.5Mhz) x 1024 x 256 = 15,89 ms\n  TCCR0A=0x00;                      //Modo Normal\n  TCCR0B=0x00;\n  TCCR0B |= (1<<CS00)|(1<<CS02);   //prescaler de 1024\n  TCNT0=0;                         //inicia timer com 0\n  \n  /**\n   * @brief loop infinito\n   * \n   */\n  while (1)\n  {\n    if(testBit(TIFR,TOV0))         //se timer estourou\n    {\n      setBit(TIFR,TOV0);           //limpa flag\n      tempo++;                     //incrementa contador auxiliar\n      if(tempo >=63)               //se passaram-se 63 x 15,89 ms = 1 s\n      {\n        toogleBit(PORTB,PB1);      //inverte LED\n        tempo = 0;                 //reinicia contador\n      }\n    }\n  }                                                \n  return (0);                           \n}\n'})}),"\n",(0,i.jsx)(o.h3,{id:"simula\xe7\xe3o-do-exemplo",children:"Simula\xe7\xe3o do exemplo"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsx)(o.li,{children:"**Wokwi: **"}),"\n"]}),"\n",(0,i.jsx)("iframe",{width:"100%",height:"458px",src:"https://wokwi.com/arduino/projects/305410400451560001?view=diagram"}),"\n",(0,i.jsxs)(o.ul,{children:["\n",(0,i.jsxs)(o.li,{children:[(0,i.jsx)(o.strong,{children:"PICSimLab:"})," ",(0,i.jsx)(o.a,{href:"https://lcgamboa.github.io/picsimlab_examples/board_Franzininho_DIY.html#board_Franzininho_DIY_attiny85",children:"https://lcgamboa.github.io/picsimlab_examples/board_Franzininho_DIY.html#board_Franzininho_DIY_attiny85"})]}),"\n"]})]})}function m(e={}){const{wrapper:o}={...(0,n.M)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},17712:(e,o,r)=>{r.d(o,{c:()=>i});const i=r.p+"assets/images/timer0-block-diagram-5e71243b7bad24e5127e6f41dfaedde0.png"},37276:(e,o,r)=>{r.d(o,{c:()=>i});const i=r.p+"assets/images/timer0-config1-7bc446e41376fe89fecb317e4ac0d04e.png"},84640:(e,o,r)=>{r.d(o,{c:()=>i});const i=r.p+"assets/images/timer0-config2-4933e7715c9acc2a35bdda2c4012d605.png"},9264:(e,o,r)=>{r.d(o,{c:()=>i});const i=r.p+"assets/images/timer0-config3-874ed73be5590580496ee7b7f893b26e.png"},4552:(e,o,r)=>{r.d(o,{I:()=>d,M:()=>a});var i=r(11504);const n={},s=i.createContext(n);function a(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function d(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);