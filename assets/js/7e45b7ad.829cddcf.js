"use strict";(self.webpackChunkFranzininho=self.webpackChunkFranzininho||[]).push([[1744],{84220:(e,a,o)=>{o.r(a),o.d(a,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>l});var n=o(17624),r=o(95788);const i={id:"buzzer",title:"Instrumento musical com Buzzer",slug:"/franzininho-diy/exemplos-avr-libc/buzzer",description:"Nesse exemplo vamos criar um programa que l\xea uma partitura e toca a m\xfasica escrita atrav\xe9s de um buzzer no Franzininho DIY",authors:"Eduardo Due\xf1as",date:"05/06/2020",some_url:"https://github.com/EduardoDuenas"},t=void 0,s={id:"FranzininhoDIY/exemplos-avr-libc/buzzer",title:"Instrumento musical com Buzzer",description:"Nesse exemplo vamos criar um programa que l\xea uma partitura e toca a m\xfasica escrita atrav\xe9s de um buzzer no Franzininho DIY",source:"@site/docs/FranzininhoDIY/exemplos-avr-libc/buzzer.md",sourceDirName:"FranzininhoDIY/exemplos-avr-libc",slug:"/franzininho-diy/exemplos-avr-libc/buzzer",permalink:"/docs/franzininho-diy/exemplos-avr-libc/buzzer",draft:!1,unlisted:!1,editUrl:"https://github.com/Franzininho/docs-franzininho-site/edit/main/docs/FranzininhoDIY/exemplos-avr-libc/buzzer.md",tags:[],version:"current",frontMatter:{id:"buzzer",title:"Instrumento musical com Buzzer",slug:"/franzininho-diy/exemplos-avr-libc/buzzer",description:"Nesse exemplo vamos criar um programa que l\xea uma partitura e toca a m\xfasica escrita atrav\xe9s de um buzzer no Franzininho DIY",authors:"Eduardo Due\xf1as",date:"05/06/2020",some_url:"https://github.com/EduardoDuenas"},sidebar:"docs",previous:{title:"Contador de pulsos externos",permalink:"/docs/franzininho-diy/exemplos-avr-libc/contadores"},next:{title:"Interrup\xe7\xe3o externa",permalink:"/docs/franzininho-diy/exemplos-avr-libc/int-ext"}},c={},l=[{value:"<strong>Recursos necess\xe1rios</strong>",id:"recursos-necess\xe1rios",level:2},{value:"<strong>Fazendo m\xfasica com o Buzzer</strong>",id:"fazendo-m\xfasica-com-o-buzzer",level:2},{value:"<strong>C\xf3digo</strong>",id:"c\xf3digo",level:3},{value:"<strong>Montagem</strong>",id:"montagem",level:3},{value:"<strong>Compila\xe7\xe3o e upload</strong>",id:"compila\xe7\xe3o-e-upload",level:3},{value:"<strong>Resultado</strong>",id:"resultado",level:3},{value:"<strong>Conclus\xe3o</strong>",id:"conclus\xe3o",level:2},{value:"Gloss\xe1rio",id:"gloss\xe1rio",level:2}];function d(e){const a={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.MN)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.p,{children:"Nesse exemplo vamos criar um programa que l\xea uma partitura e toca a m\xfasica escrita atrav\xe9s de um buzzer na Franzininho DIY. Vamos aprender como se usar um buzzer passivo para gerar cada nota musical com ajuda do timer0."}),"\n",(0,n.jsx)(a.p,{children:"Boa pr\xe1tica!"}),"\n",(0,n.jsx)(a.h2,{id:"recursos-necess\xe1rios",children:(0,n.jsx)(a.strong,{children:"Recursos necess\xe1rios"})}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Franzininho DIY (com Micronucleos)"}),"\n",(0,n.jsx)(a.li,{children:"1 buzzer passivo 5v"}),"\n",(0,n.jsx)(a.li,{children:"4 jumpers macho-f\xeamea"}),"\n",(0,n.jsx)(a.li,{children:"1 jumper macho-macho"}),"\n"]}),"\n",(0,n.jsx)(a.h2,{id:"fazendo-m\xfasica-com-o-buzzer",children:(0,n.jsx)(a.strong,{children:"Fazendo m\xfasica com o Buzzer"})}),"\n",(0,n.jsxs)(a.p,{children:["Nesse exemplo vamos atrav\xe9s de uma ",(0,n.jsx)(a.em,{children:"lookup table"})," vamos ensinar quais as frequ\xeancias de cada nota, e com o uso do timer vamos variar a entrada no buzzer na frequ\xeancia da nota que queremos. Com a ajuda de outra tabela, vamos dar para o Franzininho a sequ\xeancia das notas que queremos que ele toque, podendo assim, tocar a m\xfasica que quisermos."]}),"\n",(0,n.jsx)(a.p,{children:"O buzzer passivo funciona como um pequeno alto falante, enquanto tivermos a tens\xe3o nominal na entrada positiva e o terra na entrada negativa o im\xe3 dentro dele vai para frente. Por outro lado, quando tivermos terra em ambas ele volta para a posi\xe7\xe3o inicial. Se variarmos entre esses dois estados na frequ\xeancia de uma nota musical geraremos uma onda sonora com o tom dela."}),"\n",(0,n.jsxs)(a.p,{children:["As notas musicais ocidentais em uma escala maior s\xe3o ",(0,n.jsx)(a.em,{children:"Do Do# Re Re# Mi Fa Fa# Sol Sol# L\xe1 L\xe1# Si"})," voltando para ",(0,n.jsx)(a.em,{children:"Do"})," depois. Cada nota est\xe1 a uma dist\xe2ncia de meio tom da outra e a 6 tons de sua pr\xf3xima oitava, que \xe9 a mesma nota por\xe9m mais fina."]}),"\n",(0,n.jsxs)(a.p,{children:["Olhando pela frequ\xeancia temos que partindo de ",(0,n.jsx)(a.em,{children:"L\xe1"})," da terceira oitava, 440Hz, cada ",(0,n.jsx)(a.em,{children:"L\xe1"})," uma oitava acima tem o dobro da frequ\xeancia e cada oitava a baixo tem metade da frequ\xeancia. J\xe1 para subir cada semitom, basta multiplicar por 2^(1/12), ou para x semitons, 2^(x/12)."]}),"\n",(0,n.jsx)(a.h3,{id:"c\xf3digo",children:(0,n.jsx)(a.strong,{children:"C\xf3digo"})}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-c",children:'/***********************************************\n * @file main.c\n * @author Eduardo Due\xf1as / Daniel Quadros\n * @brief Exemplo tocar musicas usando buzzer\n * @version 1.0\n * @date 21/04/2021\n *\n * \xfaltima modifica\xe7\xe3o: 15/05/2021\n **********************************************/\n#include <avr/io.h>\n#include <avr/interrupt.h>\n\n#define F_CPU 16500000L\n\n#define setBit(valor,bit)      (valor |= (1 << bit))\n#define clearBit(valor,bit)    (valor &= ~(1 << bit))\n#define toogleBit(valor,bit)   (valor ^= (1 << bit))\n#define testBit(valor,bit)     (valor & (1 << bit))\n\n\n#define NumNotas 32\n#define CONT(freq) ((F_CPU*10L)/(256L*freq))\n\nenum notas {Pausa, Do, DoS, Re, ReS, Mi, Fa, FaS, Sol, SolS, La, LaS, Si, DoM, DoSM, ReM};\nlong f[16] = {\n    255L, (long)CONT(5232L), (long)CONT(5543L), (long)CONT(5873L), (long)CONT(6222L), (long)CONT(6592L), (long)CONT(6984L),\n    (long)CONT(7400L), (long)CONT(7840L), (long)CONT(8306L), (long)CONT(8800L), (long)CONT(9323L), (long)CONT(9877L),\n    (long)CONT(10465L), (long)CONT(11087L), (long)CONT(11746L)\n};\n\n// {0xFF,123, 116, 110, 104, 98, 92, 87, 82, 78, 73, 69, 65, 62, 58, 54}\n// Lookup table com os valores de cada nota a ser colocado na flag do timer\n\nchar Partitura[NumNotas] = {\n    Re, Mi, Mi, Re, Sol, FaS, FaS, FaS, Re, Mi, Mi, Re, La, Sol, Sol, Sol,\n    Re, ReM, ReM, Si, Sol, FaS, FaS, Mi, DoM, Si, Si, Sol, La, Sol, Sol, Sol\n};                                       // Partitura da m\xfasica\nvolatile char cont = 0;                  // Local da partitura\nvolatile long aux = 0;\n\n// Tratamento de interrup\xe7\xe3o\nISR (TIM0_COMPB_vect) {                  // Vetor de compara\xe7\xe3o B\n  if (aux <= 0xff) {                     // Se aux menor que 8bits\n    OCR0B = (TCNT0 + aux) & (0xff);      // Mandar aux para o contador\n    aux = f[Partitura[cont]];            // Reinicia o aux\n    toogleBit(PORTB, PB1);               // Inverter o buzzer\n  }\n  else {                                 // Se n\xe3o\n    OCR0B = TCNT0;                       // Mandar o tempoatual para o contador, o mesmo que esperar um overflow\n    aux -= 0xff;                         // Subitrair 8bits do aux\n  }\n}\n\n// Fun\xe7\xe3o main\nint main() {\n  enum notas nota;\n  setBit(DDRB, PB1);                     // Configura o PortB1 como sa\xedda, pino do buzzer\n\n  // Configura\xe7\xe3o do timer\n  TCCR0A = 0x00;                         // Configura pino de comparara\xe7\xe3o desconectado\n  TCCR0B = 0x04;                         // Configura o prescaler como 256\n  setBit(TIMSK, OCIE0B);                 // Habilita a interrup\xe7\xe3o por compara\xe7\xe3o de COMPB\n  sei();                                 // Habilita interrup\xe7\xf5es globais\n  aux = f[Partitura[cont]];              // Inicia o contador de COMPB\n\n  if (aux <= 0xff) {\n    OCR0B = (TCNT0 + aux) & (0xff);\n    aux = f[Partitura[cont]];\n    toogleBit(PORTB, PB1);\n  }\n  else {\n    OCR0B = TCNT0;\n    aux -= 0xff;\n  }\n\n  // Loop infinito\n  for (;;) {\n    long i;\n    for (i = 0; i < 1000000L; i++) {\n      asm ("nop");\n      cont++;                            // Avan\xe7a na partitura\n      if (cont >= NumNotas)cont = 0;     // Toca de novo\n  }\n}\n'})}),"\n",(0,n.jsx)(a.h3,{id:"montagem",children:(0,n.jsx)(a.strong,{children:"Montagem"})}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.img,{alt:"circuito buzzer",src:o(99732).c+"",width:"2535",height:"636"})}),"\n",(0,n.jsx)(a.p,{children:"Dependendo do buzzer \xe9 necess\xe1rio conectar os jumpers diretamente nos pinos do buzzer ao inv\xe9s de coloc\xe1-lo na protoboard."}),"\n",(0,n.jsx)(a.h3,{id:"compila\xe7\xe3o-e-upload",children:(0,n.jsx)(a.strong,{children:"Compila\xe7\xe3o e upload"})}),"\n",(0,n.jsxs)(a.p,{children:["Para compilar o programa, acesse a pasta do exemplo e d\xea o comando ",(0,n.jsx)(a.code,{children:"make"}),":"]}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"exemplos-avr-libc/exemplos/buzzer$ make\n"})}),"\n",(0,n.jsx)(a.p,{children:"Como j\xe1 temos o makerfile configurado na pasta, ser\xe1 feita compila\xe7\xe3o e deve aparecer a seguinte mensagem:"}),"\n",(0,n.jsx)(a.pre,{children:(0,n.jsx)(a.code,{className:"language-bash",children:"../../micronucleus/2.0a4/launcher  -cdigispark --timeout 60 -Uflash:w:main.hex:i\nRunning Digispark Uploader...\nPlug in device now... (will timeout in 60 seconds)\n> Please plug in the device (will time out in 60 seconds) ...\n"})}),"\n",(0,n.jsx)(a.p,{children:"Conecte a placa em uma entrada USB ou, caso a Franzininho j\xe1 esteja conectada, aperte o bot\xe3o de reset para iniciar o upload."}),"\n",(0,n.jsx)(a.h3,{id:"resultado",children:(0,n.jsx)(a.strong,{children:"Resultado"})}),"\n",(0,n.jsx)(a.p,{children:"O buzzer deve tocar Parab\xe9ns para voc\xea e deve continuar em loop at\xe9 a placa ser desligada."}),"\n",(0,n.jsx)(a.p,{children:(0,n.jsx)(a.a,{href:"https://wokwi.com/arduino/projects/302834828095521293",children:"Simule esse exemplo no WokWi"})}),"\n",(0,n.jsx)(a.h2,{id:"conclus\xe3o",children:(0,n.jsx)(a.strong,{children:"Conclus\xe3o"})}),"\n",(0,n.jsx)(a.p,{children:"O buzzer passivo \xe9 um componente muito vers\xe1til com o qual podemos, n\xe3o s\xf3, tocar m\xfasicas como tamb\xe9m gerar diversos tipos de efeitos sonoros, tudo que precisamos \xe9 entender como gerar o som que queremos. Al\xe9m disso vimos como podemos usar interrup\xe7\xf5es de timer para fun\xe7\xf5es que precisam de Real Time, ou seja, que precisam de precis\xe3o de tempo."}),"\n",(0,n.jsx)(a.h2,{id:"gloss\xe1rio",children:"Gloss\xe1rio"}),"\n",(0,n.jsxs)(a.ul,{children:["\n",(0,n.jsx)(a.li,{children:"Setar: colocar um novo valor em um registrador. Para um bit \xe9 convencionado setar, mud\xe1-lo para valor 1, e clear (limpar), mud\xe1-lo para valor 0"}),"\n",(0,n.jsx)(a.li,{children:"Resetar: reiniciar"}),"\n",(0,n.jsx)(a.li,{children:"Timer: circuito eletr\xf4nico dedicado a contagem de tempo"}),"\n",(0,n.jsx)(a.li,{children:"Lookup table: tabela de consulta, no contexto de programa\xe7\xe3o \xe9 um vetor com informa\xe7\xf5es necess\xe1rias para o programa."}),"\n"]}),"\n",(0,n.jsxs)(a.table,{children:[(0,n.jsx)(a.thead,{children:(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.th,{children:"Autor"}),(0,n.jsx)(a.th,{children:(0,n.jsx)(a.a,{href:"https://github.com/EduardoDuenas",children:"Eduardo Due\xf1as"})})]})}),(0,n.jsx)(a.tbody,{children:(0,n.jsxs)(a.tr,{children:[(0,n.jsx)(a.td,{children:"Data:"}),(0,n.jsx)(a.td,{children:"05/06/2020"})]})})]})]})}function u(e={}){const{wrapper:a}={...(0,r.MN)(),...e.components};return a?(0,n.jsx)(a,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},95788:(e,a,o)=>{o.d(a,{MN:()=>l});var n=o(11504);function r(e,a,o){return a in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function i(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),o.push.apply(o,n)}return o}function t(e){for(var a=1;a<arguments.length;a++){var o=null!=arguments[a]?arguments[a]:{};a%2?i(Object(o),!0).forEach((function(a){r(e,a,o[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))}))}return e}function s(e,a){if(null==e)return{};var o,n,r=function(e,a){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],a.indexOf(o)>=0||(r[o]=e[o]);return r}(e,a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],a.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var c=n.createContext({}),l=function(e){var a=n.useContext(c),o=a;return e&&(o="function"==typeof e?e(a):t(t({},a),e)),o},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},u=n.forwardRef((function(e,a){var o=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=l(o),p=r,h=m["".concat(c,".").concat(p)]||m[p]||d[p]||i;return o?n.createElement(h,t(t({ref:a},u),{},{components:o})):n.createElement(h,t({ref:a},u))}));u.displayName="MDXCreateElement"},99732:(e,a,o)=>{o.d(a,{c:()=>n});const n=o.p+"assets/images/Exemplo_Buzzer_Circuito-a4e81be25a4bb91d65d45043dffc52ac.png"}}]);