"use strict";(self.webpackChunkFranzininho=self.webpackChunkFranzininho||[]).push([[1832],{3905:(e,r,o)=>{o.d(r,{Zo:()=>p,kt:()=>f});var n=o(7294);function t(e,r,o){return r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function i(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?i(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function l(e,r){if(null==e)return{};var o,n,t=function(e,r){if(null==e)return{};var o,n,t={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],r.indexOf(o)>=0||(t[o]=e[o]);return t}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],r.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var s=n.createContext({}),m=function(e){var r=n.useContext(s),o=r;return e&&(o="function"==typeof e?e(r):a(a({},r),e)),o},p=function(e){var r=m(e.components);return n.createElement(s.Provider,{value:r},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},d=n.forwardRef((function(e,r){var o=e.components,t=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=m(o),d=t,f=u["".concat(s,".").concat(d)]||u[d]||c[d]||i;return o?n.createElement(f,a(a({ref:r},p),{},{components:o})):n.createElement(f,a({ref:r},p))}));function f(e,r){var o=arguments,t=r&&r.mdxType;if("string"==typeof e||t){var i=o.length,a=new Array(i);a[0]=d;var l={};for(var s in r)hasOwnProperty.call(r,s)&&(l[s]=r[s]);l.originalType=e,l[u]="string"==typeof e?e:t,a[1]=l;for(var m=2;m<i;m++)a[m]=o[m];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}d.displayName="MDXCreateElement"},3386:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>s,contentTitle:()=>a,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>m});var n=o(3117),t=(o(7294),o(3905));const i={id:"timer0-int",title:"Timer 0 - Interrup\xe7\xe3o",slug:"/franzininho-diy/exemplos-avr-libc/timer0-int",description:"Vamos aprender usar o timer 0 como temporizador e usando sua interrup\xe7\xe3o",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},a=void 0,l={unversionedId:"FranzininhoDIY/exemplos-avr-libc/timer0-int",id:"FranzininhoDIY/exemplos-avr-libc/timer0-int",title:"Timer 0 - Interrup\xe7\xe3o",description:"Vamos aprender usar o timer 0 como temporizador e usando sua interrup\xe7\xe3o",source:"@site/docs/FranzininhoDIY/exemplos-avr-libc/timer0-int.md",sourceDirName:"FranzininhoDIY/exemplos-avr-libc",slug:"/franzininho-diy/exemplos-avr-libc/timer0-int",permalink:"/docs/franzininho-diy/exemplos-avr-libc/timer0-int",draft:!1,editUrl:"https://github.com/Franzininho/docs-franzininho-site/edit/main/docs/FranzininhoDIY/exemplos-avr-libc/timer0-int.md",tags:[],version:"current",frontMatter:{id:"timer0-int",title:"Timer 0 - Interrup\xe7\xe3o",slug:"/franzininho-diy/exemplos-avr-libc/timer0-int",description:"Vamos aprender usar o timer 0 como temporizador e usando sua interrup\xe7\xe3o",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},sidebar:"docs",previous:{title:"Timer 0",permalink:"/docs/franzininho-diy/exemplos-avr-libc/timer0"},next:{title:"Contador de pulsos externos",permalink:"/docs/franzininho-diy/exemplos-avr-libc/contadores"}},s={},m=[{value:"Interrup\xe7\xe3o do Timer0",id:"interrup\xe7\xe3o-do-timer0",level:2},{value:"Usando o Timer0 como temporizador com sua interrup\xe7\xe3o",id:"usando-o-timer0-como-temporizador-com-sua-interrup\xe7\xe3o",level:2},{value:"Recursos necess\xe1rios",id:"recursos-necess\xe1rios",level:3},{value:"C\xf3digo exemplo",id:"c\xf3digo-exemplo",level:3},{value:"Simula\xe7\xe3o do exemplo",id:"simula\xe7\xe3o-do-exemplo",level:3}],p={toc:m},u="wrapper";function c(e){let{components:r,...i}=e;return(0,t.kt)(u,(0,n.Z)({},p,i,{components:r,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"Nesse exemplo vamos entender como usar a interrup\xe7\xe3o do Timer0 para verificar o seu overflow. Dessa forma n\xe3o precisaremos ficar monitorando o flag de overflow no loop principal da aplica\xe7\xe3o."),(0,t.kt)("h2",{id:"interrup\xe7\xe3o-do-timer0"},"Interrup\xe7\xe3o do Timer0"),(0,t.kt)("p",null,"No exemplo anterior configuramos o Timer0 para operar no modo  normal. Para monitora a sua contagem monitoramos o flag TOV0  dentro do loop. Como o Timer \xe9 um perif\xe9rico que funciona independente  da CPU podemos habilitar a sua contagem e verificar o overflow atrav\xe9s  da sua interrup\xe7\xe3o. "),(0,t.kt)("p",null,"Para habilitar a interrup\xe7\xe3o do Timer0 devermos colocar 1 no bit ",(0,t.kt)("strong",{parentName:"p"},"TOIE0")," no registrador ",(0,t.kt)("strong",{parentName:"p"},"TIMSK"),":"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"TIMSK",src:o(1827).Z,width:"836",height:"158"})),(0,t.kt)("p",null,"Ap\xf3s isso, para que a interrup\xe7\xe3o realmente ocorra, devemos habilitar a chave global de interrup\xe7\xe3o atrav\xe9s da fun\xe7\xe3o sei();"),(0,t.kt)("h2",{id:"usando-o-timer0-como-temporizador-com-sua-interrup\xe7\xe3o"},"Usando o Timer0 como temporizador com sua interrup\xe7\xe3o"),(0,t.kt)("p",null,"Vamos  fazer a mesma aplica\xe7\xe3o do exemplo anterior, que \xe9 inverter o estado lo  LED em intervalos de 1 s. A diferen\xe7a aqui \xe9 que vamos monitorar os  overflows do timer atrav\xe9s da rotina de interrup\xe7\xe3o. "),(0,t.kt)("p",null,"A configura\xe7\xe3o do timer segue a mesma, j\xe1 que queremos gerar um delay de 1 segundo. "),(0,t.kt)("p",null,"Assim, precisaremos contar a quantidade de interrup\xe7\xf5es e quando atingir 63, inverteremos o estado do LED."),(0,t.kt)("h3",{id:"recursos-necess\xe1rios"},"Recursos necess\xe1rios"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Placa Franzininho DIY(com Micronucleus);"),(0,t.kt)("li",{parentName:"ul"},"LED;"),(0,t.kt)("li",{parentName:"ul"},"Resistor de 470 Ohm;"),(0,t.kt)("li",{parentName:"ul"},"Jumpers;"),(0,t.kt)("li",{parentName:"ul"},"Computador com as ferramentas de software instaladas.")),(0,t.kt)("h3",{id:"c\xf3digo-exemplo"},"C\xf3digo exemplo"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},'/**\n * \n * @file main.c\n * @author F\xe1bio Souza\n * @brief Exibe como usar a interrup\xe7\xe3o do timer 0 para temporiza\xe7\xe3o\n * @version 0.1\n * @date 2021-02-13\n * \n * @copyright Franzininho \n * This example code is in the Public Domain (or CC0 licensed, at your option.)\n * Unless required by applicable law or agreed to in writing, this\n * software is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied.\n * \n */\n\n#include <avr/io.h>\n#include <util/delay.h> \n#include <avr/interrupt.h>\n\n#define F_CPU 16500000L\n\n    \n#define setBit(valor,bit) (valor |= (1<<bit))\n#define clearBit(valor,bit) (valor &= ~(1<<bit))\n#define toogleBit(valor,bit) (valor ^= (1<<bit))\n#define testBit(valor,bit)    (valor & (1<<bit))\n\nunsigned char tempo = 0;  //contador auxiliar\n\n\nISR (TIMER0_OVF_vect) //vetor de interrup\xe7\xe3o para o timer 0\n{\n  tempo++;                     //incrementa contador auxiliar\n  if(tempo >=63)               //se passaram-se 63 x 15,89 ms = 1 s\n  {\n    toogleBit(PORTB,PB1);      //inverte LED\n    tempo = 0;                 //reinicia contador\n  }\n}\n\n/**\n * @brief Fun\xe7\xe3o main\n * \n * @return int \n */\nint main(void) \n{\n  \n  setBit(DDRB,PB1);     // Configura Pino PB1 como sa\xedda (Pino do LED)\n\n  //configura\xe7\xe3o do timer0 para overflow a aproximadamente 15,89 ms\n  //t = (1/16.5Mhz) x 1024 x 256 = 15,89 ms\n  TCCR0A=0x00;                      //Modo Normal\n  TCCR0B=0x00;\n  TCCR0B |= (1<<CS00)|(1<<CS02);   //prescaler de 1024\n  TCNT0=0;                         //inicia timer com 0\n  setBit(TIMSK,TOIE0);             //habilita interrup\xe7\xe3o do timer0 \n  sei();                           //habilita interrup\xe7\xe3o global\n  \n  /**\n   * @brief loop infinito\n   * \n   */\n  while (1)\n  {\n      //n\xe3o faz nada no loop \n  }                                                \n  return (0);                           \n}\n')),(0,t.kt)("admonition",{title:"Informa\xe7\xe3o",type:"note"},(0,t.kt)("p",{parentName:"admonition"},"Note que no loop principal n\xe3o fizemos nada. Todo o tratamento ficou na interrup\xe7\xe3o do Timer0.")),(0,t.kt)("h3",{id:"simula\xe7\xe3o-do-exemplo"},"Simula\xe7\xe3o do exemplo"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Wokwi: "))),(0,t.kt)("iframe",{width:"100%",height:"458px",src:"https://wokwi.com/arduino/projects/306143631949955648?view=diagram"}))}c.isMDXComponent=!0},1827:(e,r,o)=>{o.d(r,{Z:()=>n});const n=o.p+"assets/images/TIMSK-a059550570192a069297e5ea900b71ef.png"}}]);