"use strict";(self.webpackChunkFranzininho=self.webpackChunkFranzininho||[]).push([[310],{3905:(e,r,o)=>{o.d(r,{Zo:()=>d,kt:()=>g});var a=o(7294);function t(e,r,o){return r in e?Object.defineProperty(e,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[r]=o,e}function i(e,r){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),o.push.apply(o,a)}return o}function n(e){for(var r=1;r<arguments.length;r++){var o=null!=arguments[r]?arguments[r]:{};r%2?i(Object(o),!0).forEach((function(r){t(e,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(o,r))}))}return e}function s(e,r){if(null==e)return{};var o,a,t=function(e,r){if(null==e)return{};var o,a,t={},i=Object.keys(e);for(a=0;a<i.length;a++)o=i[a],r.indexOf(o)>=0||(t[o]=e[o]);return t}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)o=i[a],r.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(t[o]=e[o])}return t}var l=a.createContext({}),m=function(e){var r=a.useContext(l),o=r;return e&&(o="function"==typeof e?e(r):n(n({},r),e)),o},d=function(e){var r=m(e.components);return a.createElement(l.Provider,{value:r},e.children)},p="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return a.createElement(a.Fragment,{},r)}},u=a.forwardRef((function(e,r){var o=e.components,t=e.mdxType,i=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=m(o),u=t,g=p["".concat(l,".").concat(u)]||p[u]||c[u]||i;return o?a.createElement(g,n(n({ref:r},d),{},{components:o})):a.createElement(g,n({ref:r},d))}));function g(e,r){var o=arguments,t=r&&r.mdxType;if("string"==typeof e||t){var i=o.length,n=new Array(i);n[0]=u;var s={};for(var l in r)hasOwnProperty.call(r,l)&&(s[l]=r[l]);s.originalType=e,s[p]="string"==typeof e?e:t,n[1]=s;for(var m=2;m<i;m++)n[m]=o[m];return a.createElement.apply(null,n)}return a.createElement.apply(null,o)}u.displayName="MDXCreateElement"},2639:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>l,contentTitle:()=>n,default:()=>c,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var a=o(3117),t=(o(7294),o(3905));const i={id:"timer0",title:"Timer 0",slug:"/franzininho-diy/exemplos-avr-libc/timer0",description:"Vamos aprender usar o timer 0 como temporizador",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},n=void 0,s={unversionedId:"FranzininhoDIY/exemplos-avr-libc/timer0",id:"FranzininhoDIY/exemplos-avr-libc/timer0",title:"Timer 0",description:"Vamos aprender usar o timer 0 como temporizador",source:"@site/docs/FranzininhoDIY/exemplos-avr-libc/timer0.md",sourceDirName:"FranzininhoDIY/exemplos-avr-libc",slug:"/franzininho-diy/exemplos-avr-libc/timer0",permalink:"/docs/franzininho-diy/exemplos-avr-libc/timer0",draft:!1,editUrl:"https://github.com/Franzininho/docs-franzininho-site/edit/main/docs/FranzininhoDIY/exemplos-avr-libc/timer0.md",tags:[],version:"current",frontMatter:{id:"timer0",title:"Timer 0",slug:"/franzininho-diy/exemplos-avr-libc/timer0",description:"Vamos aprender usar o timer 0 como temporizador",authors:"F\xe1bio Souza",date:"24/04/2021",some_url:"https://github.com/FBSeletronica"},sidebar:"docs",previous:{title:"Entrada Digital",permalink:"/docs/franzininho-diy/exemplos-avr-libc/entrada-digital"},next:{title:"Timer 0 - Interrup\xe7\xe3o",permalink:"/docs/franzininho-diy/exemplos-avr-libc/timer0-int"}},l={},m=[{value:"Caracter\xedsticas do Timer0",id:"caracter\xedsticas-do-timer0",level:2},{value:"Resumo de recursos do Timer0",id:"resumo-de-recursos-do-timer0",level:2},{value:"Usando o Timer0 como temporizador",id:"usando-o-timer0-como-temporizador",level:2},{value:"Passo para configurar o Timer0 como temporizador",id:"passo-para-configurar-o-timer0-como-temporizador",level:3},{value:"Calculo do Delay",id:"calculo-do-delay",level:3},{value:"Passos para monitorar o overflow do timer e gerar o delay de 1s",id:"passos-para-monitorar-o-overflow-do-timer-e-gerar-o-delay-de-1s",level:3},{value:"Recursos necess\xe1rios",id:"recursos-necess\xe1rios",level:3},{value:"C\xf3digo exemplo",id:"c\xf3digo-exemplo",level:3},{value:"Simula\xe7\xe3o do exemplo",id:"simula\xe7\xe3o-do-exemplo",level:3}],d={toc:m},p="wrapper";function c(e){let{components:r,...i}=e;return(0,t.kt)(p,(0,a.Z)({},d,i,{components:r,mdxType:"MDXLayout"}),(0,t.kt)("p",null,"Os timers s\xe3o perif\xe9ricos muito importantes nos microcontroladores. Podemos us\xe1-los para temporiza\xe7\xe3o, contagem de eventos, PWM, medir pulsos externos, etc. O ATtiny85 possui 2 timers, chamados de Timer0 e Timer1. Nesse exemplos vamos focar no uso do Timer0 como temporizador."),(0,t.kt)("h2",{id:"caracter\xedsticas-do-timer0"},"Caracter\xedsticas do Timer0"),(0,t.kt)("p",null,"O Timer0 \xe9 um m\xf3dulo temporizador/contador de 8 bits de uso geral. Isso significa que ele pode contar de 0 a 255. A funcionalidade de temporiza\xe7\xe3o pode ser estendida ainda mais usando os perif\xe9ricos de compara\xe7\xe3o, que permitem que o temporizador conte eventos, gere sinais PWM e assim por diante. Assim \xe9 poss\xedvel gerar temporiza\xe7\xf5es precisas, ondas e sinais PWM independentes da CPU."),(0,t.kt)("p",null,"A figura a seguir exibe o diagrama de blocos simplificado do Timer0:"),(0,t.kt)("p",null,(0,t.kt)("img",{alt:"Diagrama de blocos do Timer0",src:o(7289).Z,width:"862",height:"668"})),(0,t.kt)("h2",{id:"resumo-de-recursos-do-timer0"},"Resumo de recursos do Timer0"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Duas unidades de compara\xe7\xe3o de sa\xedda independentes;"),(0,t.kt)("li",{parentName:"ul"},"Registradores de compara\xe7\xe3o de sa\xedda com buffer duplo;"),(0,t.kt)("li",{parentName:"ul"},"Limpa cron\xf4metro na compara\xe7\xe3o de correspond\xeancia (recarregamento autom\xe1tico);"),(0,t.kt)("li",{parentName:"ul"},"Modulador de largura de pulso com corre\xe7\xe3o de fase (PWM) livre de glitch;"),(0,t.kt)("li",{parentName:"ul"},"Per\xedodo PWM vari\xe1vel;"),(0,t.kt)("li",{parentName:"ul"},"Gerador de frequ\xeancia;"),(0,t.kt)("li",{parentName:"ul"},"Tr\xeas fontes de interrup\xe7\xe3o independentes (TOV0, OCF0A e OCF0B);")),(0,t.kt)("h2",{id:"usando-o-timer0-como-temporizador"},"Usando o Timer0 como temporizador"),(0,t.kt)("p",null,"Nesse exemplos vamos usar o Timer0 para gerar delay de 1s para piscar um LED."),(0,t.kt)("h3",{id:"passo-para-configurar-o-timer0-como-temporizador"},"Passo para configurar o Timer0 como temporizador"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Passo 1:")," Configurar o Timer0 para trabalhar no modo normal. Nesse modo o timer iniciar\xe1 a contagem em 0 e ir\xe1 at\xe9 m\xe1ximo de 255. Quando atingido o m\xe1ximo \xe9 gerado um flag de sinaliza\xe7\xe3o de overflow e o timer volta a contar a partir do zero."),(0,t.kt)("p",null,"Para configurar o modo de opera\xe7\xe3o normal, devemos configurar o registrador ",(0,t.kt)("strong",{parentName:"p"},"TCCR0A \u2013 Timer/Counter Control Register A")," da seguinte forma:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"COM0A","[1:0]"," e COM0B","[1:0]"," = 0")),(0,t.kt)("p",null,(0,t.kt)("img",{src:o(5301).Z,width:"840",height:"212"})),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"WGM0","[1:0]"," = 0 e TCCR0B \u2013 WGM02 = 0")),(0,t.kt)("p",null,(0,t.kt)("img",{src:o(1300).Z,width:"841",height:"333"})),(0,t.kt)("p",null,"Deve-se escrever os seguintes valores em ",(0,t.kt)("strong",{parentName:"p"},"TCCR0A \u2013 Timer/Counter Control Register A"),":"),(0,t.kt)("p",null,"TCCR0A = 0b00000000;"),(0,t.kt)("p",null,(0,t.kt)("strong",{parentName:"p"},"Passo 2:")," Ajustar o prescaler do clock interno para 1024"),(0,t.kt)("p",null,"Para ajustar o prescale precisamos configurar os bits CS02,CS01 e CS00 do TCCR0B:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"TCCR0B \u2013 CS0","[2:0]")),(0,t.kt)("p",null,(0,t.kt)("img",{src:o(4059).Z,width:"839",height:"315"})),(0,t.kt)("p",null,"Deve-se escrever os seguintes valores em ",(0,t.kt)("strong",{parentName:"p"},"TCCR0B \u2013 Timer/Counter Control Register")," B:"),(0,t.kt)("p",null,"TCCR0B = 0b00000101;"),(0,t.kt)("h3",{id:"calculo-do-delay"},"Calculo do Delay"),(0,t.kt)("p",null,"Estamos trabalhando com o clock interno do ATtiny85 em 16.5Mhz. Essa \xe9 a fonte de clock para o timer0 em modo de opera\xe7\xe3o normal. Como selecionamos o prescaler para dividir o clock por 1024, temos o incremento do timer0 em:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"tempo por incremento do timer0 = 1/(16.5M/1024) = ",(0,t.kt)("strong",{parentName:"li"},"62 us"))),(0,t.kt)("p",null,"Assim, o tempo para o timer0 estourar(overflow) \xe9:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"tempo para o timer0 estourar = 62us x 256 = ",(0,t.kt)("strong",{parentName:"li"},"15,89ms"))),(0,t.kt)("p",null,"Portanto, para ter um delay de 1 segundo precisamos ter:"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"quantidade de overflows do timer0 = 1/15,89ms \u2243 ",(0,t.kt)("strong",{parentName:"li"},"63 vezes"))),(0,t.kt)("h3",{id:"passos-para-monitorar-o-overflow-do-timer-e-gerar-o-delay-de-1s"},"Passos para monitorar o overflow do timer e gerar o delay de 1s"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Passo 0:")," Colocar TCNT0 em zero"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Passo 1:")," Aguardar a contagem do timer verificando quando TOV0 vai para 1"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Passo 2:")," Limpar a flag TOV0 escrevendo 1 nela(Isso mesmo escrevendo 1)"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Passo 3:")," Repetir passos 1 e 2 63 vezes para atingir 1 segundo"),(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Passo 4:")," Passou um segundo \u2013 Inverter LED")),(0,t.kt)("h3",{id:"recursos-necess\xe1rios"},"Recursos necess\xe1rios"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},"Placa Franzininho DIY(com Micronucleus)"),(0,t.kt)("li",{parentName:"ul"},"LED "),(0,t.kt)("li",{parentName:"ul"},"Resistor de 470 Ohm"),(0,t.kt)("li",{parentName:"ul"},"Jumpers"),(0,t.kt)("li",{parentName:"ul"},"Computador com as ferramentas de software instaladas")),(0,t.kt)("h3",{id:"c\xf3digo-exemplo"},"C\xf3digo exemplo"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-c"},'/**\n * \n * @file main.c\n * @author F\xe1bio Souza\n * @brief Exibe como usar o timer zero para temporiza\xe7\xe3o\n * @version 0.1\n * @date 2021-02-13\n * \n * @copyright Franzininho \n * This example code is in the Public Domain (or CC0 licensed, at your option.)\n * Unless required by applicable law or agreed to in writing, this\n * software is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR\n * CONDITIONS OF ANY KIND, either express or implied.\n * \n */\n\n#include <avr/io.h>\n#include <util/delay.h> \n\n#define F_CPU 16500000L\n\n    \n#define setBit(valor,bit) (valor |= (1<<bit))\n#define clearBit(valor,bit) (valor &= ~(1<<bit))\n#define toogleBit(valor,bit) (valor ^= (1<<bit))\n#define testBit(valor,bit)    (valor & (1<<bit))\n\n/**\n * @brief Fun\xe7\xe3o main\n * \n * @return int \n */\nint main(void) \n{\n  \n  unsigned char tempo = 0;  //contador auxiliar\n\n  setBit(DDRB,PB1);     // Configura Pino PB1 como sa\xedda (Pino do LED)\n\n  //configura\xe7\xe3o do timer0 para overflow a aproximadamente 15,89 ms\n  //t = (1/16.5Mhz) x 1024 x 256 = 15,89 ms\n  TCCR0A=0x00;                      //Modo Normal\n  TCCR0B=0x00;\n  TCCR0B |= (1<<CS00)|(1<<CS02);   //prescaler de 1024\n  TCNT0=0;                         //inicia timer com 0\n  \n  /**\n   * @brief loop infinito\n   * \n   */\n  while (1)\n  {\n    if(testBit(TIFR,TOV0))         //se timer estourou\n    {\n      setBit(TIFR,TOV0);           //limpa flag\n      tempo++;                     //incrementa contador auxiliar\n      if(tempo >=63)               //se passaram-se 63 x 15,89 ms = 1 s\n      {\n        toogleBit(PORTB,PB1);      //inverte LED\n        tempo = 0;                 //reinicia contador\n      }\n    }\n  }                                                \n  return (0);                           \n}\n')),(0,t.kt)("h3",{id:"simula\xe7\xe3o-do-exemplo"},"Simula\xe7\xe3o do exemplo"),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"Wokwi: "))),(0,t.kt)("iframe",{width:"100%",height:"458px",src:"https://wokwi.com/arduino/projects/305410400451560001?view=diagram"}),(0,t.kt)("ul",null,(0,t.kt)("li",{parentName:"ul"},(0,t.kt)("strong",{parentName:"li"},"PICSimLab:")," ",(0,t.kt)("a",{parentName:"li",href:"https://lcgamboa.github.io/picsimlab_examples/board_Franzininho_DIY.html#board_Franzininho_DIY_attiny85"},"https://lcgamboa.github.io/picsimlab_examples/board_Franzininho_DIY.html#board_Franzininho_DIY_attiny85"))))}c.isMDXComponent=!0},7289:(e,r,o)=>{o.d(r,{Z:()=>a});const a=o.p+"assets/images/timer0-block-diagram-5e71243b7bad24e5127e6f41dfaedde0.png"},5301:(e,r,o)=>{o.d(r,{Z:()=>a});const a=o.p+"assets/images/timer0-config1-7bc446e41376fe89fecb317e4ac0d04e.png"},1300:(e,r,o)=>{o.d(r,{Z:()=>a});const a=o.p+"assets/images/timer0-config2-4933e7715c9acc2a35bdda2c4012d605.png"},4059:(e,r,o)=>{o.d(r,{Z:()=>a});const a=o.p+"assets/images/timer0-config3-874ed73be5590580496ee7b7f893b26e.png"}}]);